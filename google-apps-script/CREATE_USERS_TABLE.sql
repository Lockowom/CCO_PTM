-- CREAR TABLA USUARIOS EN SUPABASE
-- Estructura basada en la hoja de Google Sheets proporcionada
DROP TABLE IF EXISTS public.tms_usuarios CASCADE;

CREATE TABLE public.tms_usuarios (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    id_usuario VARCHAR(100), -- Columna ID del Sheets (USR-...)
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    nombre VARCHAR(255),
    rol VARCHAR(50), -- ADMIN, SUPERVISOR, OPERARIO, TRANSPORTE, GERENCIA, ADMINISTRACION
    activo BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Insertar datos iniciales (migración)
INSERT INTO public.tms_usuarios (id_usuario, email, password_hash, nombre, rol, activo, created_at) VALUES
('USR-1765386626402', 'admin@sistema.com', '7fdd9af528878c17a8cab2a57b593f84383da01cd984759ea109bc5002fe4511', 'Administrador', 'ADMIN', TRUE, '2025-12-10T17:10:26.402Z'),
('USR-1767363491181-V08GP9', 'jguzman@ptm.cl', 'c742bea3a5fc2076a7fb5dfceea3ec1977fa2cd8e54ce559921b7eeec56ebd1a', 'Jordy Guzman', 'OPERARIO', TRUE, '2026-01-02T14:18:11.184Z'),
('USR-1767363512769-332JZ1', 'fortune@ptm.cl', 'ea7f81c653b44a6fafa652e172860d163c4b50268868ba17ed77e20119c64858', 'Jalon Elysee', 'OPERARIO', TRUE, '2026-01-02T14:18:32.772Z'),
('USR-1767363539217-MPA5T4', 'gissele@ptm.cl', 'd70cac7a215d41cb468cd3250c143b3baa6f03f733952d7d776fc6a910838b6f', 'Gisselle Romero', 'SUPERVISOR', TRUE, '2026-01-02T14:18:59.219Z'),
('USR-1767363618244-PN8GLX', 'chv@ptm.cl', '6deabbdabe2b7d07e9cc50d7dfeed99e949551603324f1ec7381d25164b9f76c', 'Christian Vargas', 'OPERARIO', TRUE, '2026-01-02T14:20:18.247Z'),
('USR-1767363747398-5ZDS1G', 'lmodric@ptm.cl', '6f2a0012d674326271e5c1979d7a3d6ea4b20b975b854e14c835dfd277977468', 'Lucas Toloza', 'OPERARIO', TRUE, '2026-01-02T14:22:27.401Z'),
('USR-1767363870800-P2CWJI', 'mnegroni@ptm.cl', '27b2e88e428897280a7fc91a8e00e1e9d3758c91605fa6676c884d96f351b893', 'Marco Negroni', 'OPERARIO', TRUE, '2026-01-02T14:24:30.816Z'),
('USR-1767364119882-R2F2GT', 'moi@ptm.cl', 'c7d508ff88d418dd322937aa456fa8b6463c060476aa4a1866671d6cadfc7fe9', 'MOISES', 'OPERARIO', TRUE, '2026-01-02T14:28:39.885Z'),
('USR-1767364185133-YMVIX1', 'lortiz@ptm.cl', '3fd177d49565728410c8d256ff69f09dbc8c51c5188533a6d9388df6620db536', 'Leonardo Ortiz', 'SUPERVISOR', TRUE, '2026-01-02T14:29:45.138Z'),
('USR-1767364619788-EZ974F', 'oleiva@ptm.cl', '107512fa3d0f720861d26ca10e3ca3a8fb3cb231600756d524eb623a48839168', 'Oscar Leiva', 'GERENCIA', TRUE, '2026-01-02T14:36:59.793Z'),
('USR-1767372839006-0ZVT6J', 'davies@ptm.cl', 'c0b4b1f1feccbc3967c9df28900a83783d33179165226f71a1deefea04be381e', 'HECTOR', 'TRANSPORTE', TRUE, '2026-01-02T16:53:59.010Z'),
('USR-1767373053545-LVBRES', 'jm@ptm.cl', 'd3077245eb74f1c586b7eea752d141fd0dbd2936819bcde4d82c5162aa0d3e57', 'JUAN MARCHANT', 'TRANSPORTE', TRUE, '2026-01-02T16:57:33.549Z'),
('USR-1768906578311-6BT1BI', 'angelica@ptm.cl', '9947636218dd741e5724e8f42da524849534807d5a27276712c786ce6fb47b8c', 'María Angélica', 'SUPERVISOR', TRUE, '2026-01-20T10:56:18.315Z'),
('USR-1768911671370-K84YRX', 'packing@ptm.cl', 'f0c3780353606e79a88c2ffda67276a61f5a75943ce2a489c33152379aff556b', 'Revision', 'OPERARIO', TRUE, '2026-01-20T12:21:11.373Z'),
('USR-1769527480864-D3SENY', 'fromero@ptm.cl', '9947636218dd741e5724e8f42da524849534807d5a27276712c786ce6fb47b8c', 'Fernanda Romero', 'ADMINISTRACION', TRUE, '2026-01-27T15:24:40.877Z'),
('USR-1770119130974-AT2MTS', 'picking1@ptm.cl', 'ff9fe09a63e63a3c5092ce2c91d3962e6084f808c425a9090b8f2bbc495777fa', 'PickingBD1', 'OPERARIO', TRUE, '2026-02-03T11:45:30.986Z'),
('USR-1770119158220-CDSD0D', 'picking2@ptm.cl', '15cf0894deb2330ec327b5f232334e942e20b103c97eda205009135bf0efed92', 'PickingBD3', 'OPERARIO', TRUE, '2026-02-03T11:45:58.225Z');

-- Índices
CREATE INDEX idx_usuarios_email ON public.tms_usuarios(email);
CREATE INDEX idx_usuarios_rol ON public.tms_usuarios(rol);
